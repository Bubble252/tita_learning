# TITA è·‘é…·è®­ç»ƒå·¥ç¨‹ä½¿ç”¨æŒ‡å—

## ğŸ“‹ é¡¹ç›®ç»“æ„

```
tita_rl/
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ tita_parkour_config.py          # â­ è·‘é…·ä¸“ç”¨é…ç½®
â”œâ”€â”€ envs/
â”‚   â””â”€â”€ parkour_robot.py                # â­ è·‘é…·ç¯å¢ƒï¼ˆå«ä¸“ç”¨å¥–åŠ±å‡½æ•°ï¼‰
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ parkour_curriculum.py           # â­ è¯¾ç¨‹å­¦ä¹ ç®¡ç†å™¨
â”œâ”€â”€ train_parkour.py                    # â­ è·‘é…·è®­ç»ƒè„šæœ¬
â””â”€â”€ test_parkour.py                     # â­ è·‘é…·æµ‹è¯•è„šæœ¬
```

---

## ğŸ“ è¯¾ç¨‹å­¦ä¹ é…ç½®

### å½“å‰é…ç½®ï¼ˆåŸºäºæ‚¨çš„è¦æ±‚ï¼‰

| é˜¶æ®µ | è¿­ä»£æ¬¡æ•° | å æ¯” | åœ°å½¢éš¾åº¦ | éšœç¢é«˜åº¦ | å…³é”®å¥–åŠ±æƒé‡ |
|-----|---------|------|---------|---------|------------|
| **é˜¶æ®µ1ï¼šåŸºç¡€è¡Œèµ°** | 10,000 | 27% | Level 0 | 5cm | obstacle_clearance=0.5 |
| **é˜¶æ®µ2ï¼šå°éšœç¢** | 10,000 | 27% | Level 3 | 10cm | obstacle_clearance=1.0, jump_timing=0.5 |
| **é˜¶æ®µ3ï¼šå®Œç¾è·‘é…·** | 17,000 | 46% | Level 7 | 15cm | obstacle_clearance=2.0, jump_timing=1.5, landing_stability=1.0 |
| **æ€»è®¡** | **37,000** | **100%** | | | |

### è¿­ä»£æ¬¡æ•°é…æ¯”è¯„ä¼°

**æ‚¨çš„é…ç½® vs æ¨èé…ç½®**ï¼š

```
æ‚¨çš„é…ç½®ï¼ˆå·²é‡‡ç”¨ï¼Œç•¥å¾®è°ƒæ•´ï¼‰ï¼š
- é˜¶æ®µ1: 10000 æ¬¡ (27%)  âœ… é€‚ä¸­ï¼ˆåŸ12000ç•¥å¤šï¼‰
- é˜¶æ®µ2: 10000 æ¬¡ (27%)  âœ… åˆç†
- é˜¶æ®µ3: 17000 æ¬¡ (46%)  âœ… å……åˆ†ï¼ˆåŸ15000ç•¥å°‘ï¼‰
- æ€»è®¡: 37000 æ¬¡

é¢„è®¡è®­ç»ƒæ—¶é—´: ~18-20 å°æ—¶ (RTX 3060)
```

**é…æ¯”åˆç†æ€§åˆ†æ**ï¼š

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|-----|------|------|
| **é˜¶æ®µ1é•¿åº¦** | â­â­â­â­ | 10000æ¬¡é€‚ä¸­ï¼Œè¶³å¤Ÿå­¦ä¼šåŸºç¡€è¡Œèµ° |
| **é˜¶æ®µ2é•¿åº¦** | â­â­â­â­â­ | 10000æ¬¡åˆç†ï¼ŒæŠ€èƒ½å­¦ä¹ å…³é”®æœŸ |
| **é˜¶æ®µ3é•¿åº¦** | â­â­â­â­â­ | 17000æ¬¡å……åˆ†ï¼Œç²¾åŒ–é˜¶æ®µéœ€è¦æ›´å¤šè¿­ä»£ |
| **æ€»ä½“å¹³è¡¡** | â­â­â­â­â­ | é…æ¯”åˆç†ï¼Œç¬¦åˆè¯¾ç¨‹å­¦ä¹ åŸåˆ™ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®­ç»ƒè·‘é…·ç­–ç•¥

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate rlgpu

# è®­ç»ƒï¼ˆæ— å¯è§†åŒ–ï¼Œé€Ÿåº¦å¿«ï¼‰
cd /home/bubble/æ¡Œé¢/tita/tita_rl
python train_parkour.py --task=tita_parkour --headless

# è®­ç»ƒï¼ˆå¸¦å¯è§†åŒ–ï¼Œé€Ÿåº¦æ…¢ï¼‰
python train_parkour.py --task=tita_parkour

# ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ
python train_parkour.py --task=tita_parkour --headless --resume --load_run=parkour_with_curriculum
```

### 2. æµ‹è¯•è®­ç»ƒå¥½çš„ç­–ç•¥

```bash
# æµ‹è¯•æœ€ç»ˆæ¨¡å‹
python test_parkour.py --task=tita_parkour --load_run=parkour_with_curriculum --checkpoint=model_final.pt

# æµ‹è¯•ç‰¹å®šæ£€æŸ¥ç‚¹
python test_parkour.py --task=tita_parkour --load_run=parkour_with_curriculum --checkpoint=model_20000.pt

# æŒ‡å®šæµ‹è¯•å›åˆæ•°
python test_parkour.py --task=tita_parkour --load_run=parkour_with_curriculum --checkpoint=model_final.pt --num_test_episodes=200
```

### 3. ç›‘æ§è®­ç»ƒè¿›åº¦

```bash
# ä½¿ç”¨ TensorBoard
tensorboard --logdir=logs/tita_parkour

# æµè§ˆå™¨è®¿é—®
http://localhost:6006
```

---

## âš™ï¸ é…ç½®è°ƒæ•´

### ä¿®æ”¹è¯¾ç¨‹å­¦ä¹ é˜¶æ®µ

ç¼–è¾‘ `utils/parkour_curriculum.py`ï¼š

```python
self.stages = [
    {
        'name': 'stage_1_flat_walking',
        'iterations': 10000,  # â† ä¿®æ”¹è¿™é‡Œ
        'terrain_level': 0,
        # ...
    },
    # ...
]
```

### ä¿®æ”¹å¥–åŠ±æƒé‡

**æ–¹æ³•1ï¼šç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶**

ç¼–è¾‘ `configs/tita_parkour_config.py`ï¼š

```python
class rewards(TitaConstraintRoughCfg.rewards):
    class scales(TitaConstraintRoughCfg.rewards.scales):
        obstacle_clearance = 2.5  # â† ä»2.0æ”¹ä¸º2.5
        jump_timing = 2.0         # â† ä»1.5æ”¹ä¸º2.0
        # ...
```

**æ–¹æ³•2ï¼šä¿®æ”¹è¯¾ç¨‹å­¦ä¹ é˜¶æ®µæƒé‡**

ç¼–è¾‘ `utils/parkour_curriculum.py`ï¼š

```python
{
    'name': 'stage_3_parkour_mastery',
    'rewards': {
        'obstacle_clearance': 2.5,  # â† ä¿®æ”¹è¿™é‡Œ
        'jump_timing': 2.0,          # â† ä¿®æ”¹è¿™é‡Œ
        # ...
    }
}
```

### ä¿®æ”¹åœ°å½¢é…ç½®

ç¼–è¾‘ `configs/tita_parkour_config.py`ï¼š

```python
class terrain(TitaConstraintRoughCfg.terrain):
    # å¢åŠ éšœç¢ç‰©æ¯”ä¾‹
    terrain_proportions = [
        0.05,  # å¹³æ»‘æ–œå¡
        0.05,  # ç²—ç³™æ–œå¡
        0.20,  # ä¸Šæ¥¼æ¢¯
        0.20,  # ä¸‹æ¥¼æ¢¯
        0.50   # ç¦»æ•£éšœç¢ â† ä»0.45å¢åŠ åˆ°0.50
    ]
```

---

## ğŸ“Š è®­ç»ƒè¿‡ç¨‹è¯´æ˜

### é˜¶æ®µåˆ‡æ¢ç¤ºä¾‹

```
============================================================
ğŸ“ è¯¾ç¨‹å­¦ä¹ é˜¶æ®µåˆ‡æ¢
============================================================
ğŸ“Œ é˜¶æ®µåç§°: stage_1_flat_walking
ğŸ“ æè¿°: å­¦ä¹ åŸºç¡€è¡Œèµ°å’Œå§¿æ€æ§åˆ¶
ğŸ”¢ å½“å‰è¿­ä»£: 0
â±ï¸  é˜¶æ®µæ—¶é•¿: 10000 iterations
ğŸ”ï¸  åœ°å½¢éš¾åº¦: Level 0
ğŸ“ éšœç¢é«˜åº¦: 5.0 cm
============================================================
ğŸ¯ å…³é”®å¥–åŠ±æƒé‡:
   obstacle_clearance       :     0.5
   jump_timing              : ä¸å­˜åœ¨
   landing_stability        : ä¸å­˜åœ¨
   collision                :    -0.5
   termination              :   -100
============================================================

... (è®­ç»ƒ10000æ¬¡è¿­ä»£) ...

============================================================
ğŸ“ è¯¾ç¨‹å­¦ä¹ é˜¶æ®µåˆ‡æ¢
============================================================
ğŸ“Œ é˜¶æ®µåç§°: stage_2_small_obstacles
ğŸ“ æè¿°: å­¦ä¹ è¯†åˆ«å’Œè·¨è¶Šå°éšœç¢
ğŸ”¢ å½“å‰è¿­ä»£: 10000
â±ï¸  é˜¶æ®µæ—¶é•¿: 10000 iterations
ğŸ”ï¸  åœ°å½¢éš¾åº¦: Level 3
ğŸ“ éšœç¢é«˜åº¦: 10.0 cm
============================================================
ğŸ¯ å…³é”®å¥–åŠ±æƒé‡:
   obstacle_clearance       :     1.0  â¬†ï¸
   jump_timing              :     0.5  âœ¨ æ–°å¢
   landing_stability        : ä¸å­˜åœ¨
   collision                :    -1.0  â¬‡ï¸
   termination              :   -150  â¬‡ï¸
============================================================
```

### è®­ç»ƒæ—¥å¿—ç¤ºä¾‹

```
============================================================
ğŸ“Š è¿­ä»£ 100/37000
============================================================
é˜¶æ®µ: stage_1_flat_walking
é˜¶æ®µè¿›åº¦: 1.0%
æ€»è¿›åº¦: 0.3%
å¹³å‡å¥–åŠ±: 45.23
å¹³å‡å›åˆé•¿åº¦: 234.5
é‡‡é›†æ—¶é—´: 2.345s
å­¦ä¹ æ—¶é—´: 0.123s
============================================================
```

---

## ğŸ” è°ƒè¯•å»ºè®®

### 1. æ£€æŸ¥è¯¾ç¨‹å­¦ä¹ é…ç½®

```bash
# è¿è¡Œè¯¾ç¨‹ç®¡ç†å™¨æŸ¥çœ‹é…ç½®
cd /home/bubble/æ¡Œé¢/tita/tita_rl
python -c "from utils.parkour_curriculum import ParkourCurriculum; c=ParkourCurriculum(); c.print_curriculum_summary()"
```

### 2. å¦‚æœæœºå™¨äººä¸è·³è·ƒ

**å¯èƒ½åŸå› **ï¼šè·³è·ƒå¥–åŠ±æƒé‡ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# åœ¨ utils/parkour_curriculum.py ä¸­
'obstacle_clearance': 3.0,  # ä»2.0å¢åŠ åˆ°3.0
'jump_timing': 2.0,         # ä»1.5å¢åŠ åˆ°2.0
```

### 3. å¦‚æœè·³è·ƒåç»å¸¸æ‘”å€’

**å¯èƒ½åŸå› **ï¼šç€é™†ç¨³å®šæ€§ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# åœ¨ utils/parkour_curriculum.py ä¸­
'landing_stability': 1.5,   # ä»1.0å¢åŠ åˆ°1.5
'orientation': -1.5,        # ä»-1.0å¢åŠ åˆ°-1.5
```

### 4. å¦‚æœè®­ç»ƒä¸æ”¶æ•›

**å¯èƒ½åŸå› **ï¼šå¥–åŠ±é‡çº§ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ‰€æœ‰è·‘é…·å¥–åŠ± Ã— 0.5
'obstacle_clearance': 1.0,  # ä»2.0å‡åŠ
'jump_timing': 0.75,        # ä»1.5å‡åŠ
'landing_stability': 0.5,   # ä»1.0å‡åŠ
```

---

## ğŸ“ˆ é¢„æœŸè®­ç»ƒæ•ˆæœ

### å„é˜¶æ®µé¢„æœŸæŒ‡æ ‡

| é˜¶æ®µ | å¹³å‡å¥–åŠ± | éšœç¢é€šè¿‡ç‡ | è·³è·ƒæˆåŠŸç‡ | Episodeé•¿åº¦ |
|-----|---------|-----------|-----------|------------|
| **é˜¶æ®µ1ç»“æŸ** | 40-60 | 60-70% | N/A | 200-300 steps |
| **é˜¶æ®µ2ç»“æŸ** | 80-120 | 75-85% | 50-60% | 300-400 steps |
| **é˜¶æ®µ3ç»“æŸ** | 150-200 | 85-90% | 75-85% | 400-500 steps |

### æ”¶æ•›æ—¶é—´

- **é˜¶æ®µ1**ï¼š~2.5-3å°æ—¶ (RTX 3060)
- **é˜¶æ®µ2**ï¼š~2.5-3å°æ—¶
- **é˜¶æ®µ3**ï¼š~4-5å°æ—¶
- **æ€»è®¡**ï¼š~10-12å°æ—¶

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### 1. configs/tita_parkour_config.py

**ä½œç”¨**ï¼šè·‘é…·ä¸“ç”¨é…ç½®æ–‡ä»¶

**å…³é”®é…ç½®**ï¼š
- `depth.use_camera = True`ï¼šå¯ç”¨æ·±åº¦ç›¸æœº
- `terrain_proportions`ï¼šåœ°å½¢æ¯”ä¾‹ï¼ˆ45%éšœç¢ç‰©ï¼‰
- `rewards.scales`ï¼šå¥–åŠ±æƒé‡ï¼ˆå«è·‘é…·ä¸“ç”¨å¥–åŠ±ï¼‰
- `num_observations`ï¼šè§‚æµ‹ç»´åº¦ï¼ˆ+5æ·±åº¦ç‰¹å¾ï¼‰

### 2. envs/parkour_robot.py

**ä½œç”¨**ï¼šè·‘é…·ç¯å¢ƒå®ç°

**æ–°å¢åŠŸèƒ½**ï¼š
- `_extract_depth_features()`ï¼šæå–5ç»´æ·±åº¦ç‰¹å¾
- `_detect_obstacles_ahead()`ï¼šéšœç¢ç‰©æ£€æµ‹
- `_reward_obstacle_clearance()`ï¼šéšœç¢æ¸…é™¤å¥–åŠ±
- `_reward_jump_timing()`ï¼šè·³è·ƒæ—¶æœºå¥–åŠ±
- `_reward_landing_stability()`ï¼šç€é™†ç¨³å®šæ€§å¥–åŠ±

### 3. utils/parkour_curriculum.py

**ä½œç”¨**ï¼šè¯¾ç¨‹å­¦ä¹ ç®¡ç†

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `get_stage(iteration)`ï¼šè·å–å½“å‰é˜¶æ®µ
- `update_reward_scales(env, stage)`ï¼šæ›´æ–°å¥–åŠ±æƒé‡
- `get_progress(iteration)`ï¼šè·å–è®­ç»ƒè¿›åº¦

### 4. train_parkour.py

**ä½œç”¨**ï¼šå¸¦è¯¾ç¨‹å­¦ä¹ çš„è®­ç»ƒè„šæœ¬

**æ ¸å¿ƒé€»è¾‘**ï¼š
- æ¯100æ¬¡è¿­ä»£æ£€æŸ¥æ˜¯å¦åˆ‡æ¢é˜¶æ®µ
- è‡ªåŠ¨æ›´æ–°å¥–åŠ±æƒé‡
- è®°å½•è¯¾ç¨‹å­¦ä¹ è¿›åº¦åˆ°TensorBoard

### 5. test_parkour.py

**ä½œç”¨**ï¼šç­–ç•¥æµ‹è¯•å’Œè¯„ä¼°

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- å¹³å‡å¥–åŠ±
- å¹³å‡å›åˆé•¿åº¦
- éšœç¢ç‰©é€šè¿‡ç‡ï¼ˆéœ€è¦ç¯å¢ƒåé¦ˆï¼‰

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å‡å°‘è®­ç»ƒæ—¶é—´ï¼Ÿ

**æ–¹æ³•1**ï¼šå‡å°‘æ€»è¿­ä»£æ¬¡æ•°
```python
# åœ¨ utils/parkour_curriculum.py ä¸­
'iterations': 8000,   # é˜¶æ®µ1ï¼šä»10000å‡åˆ°8000
'iterations': 8000,   # é˜¶æ®µ2ï¼šä»10000å‡åˆ°8000
'iterations': 14000,  # é˜¶æ®µ3ï¼šä»17000å‡åˆ°14000
# æ€»è®¡ï¼š30000æ¬¡ï¼ˆå‡å°‘7000æ¬¡ï¼ŒèŠ‚çº¦~3.5å°æ—¶ï¼‰
```

**æ–¹æ³•2**ï¼šå¢åŠ ç¯å¢ƒæ•°é‡
```python
# åœ¨ configs/tita_parkour_config.py ä¸­
num_envs = 4096  # ä»2048å¢åŠ åˆ°4096ï¼ˆéœ€è¦æ›´å¤šGPUå†…å­˜ï¼‰
```

### Q2: å¦‚ä½•ä¿å­˜ä¸­é—´æ£€æŸ¥ç‚¹ï¼Ÿ

é…ç½®å·²è‡ªåŠ¨è®¾ç½®ï¼Œæ¯500æ¬¡è¿­ä»£ä¿å­˜ä¸€æ¬¡ï¼š

```python
# åœ¨ configs/tita_parkour_config.py ä¸­
class runner(TitaConstraintRoughCfgPPO.runner):
    save_interval = 500  # æ¯500æ¬¡è¿­ä»£ä¿å­˜
```

### Q3: å¦‚ä½•å¯è§†åŒ–æ·±åº¦å›¾åƒï¼Ÿ

åœ¨è®­ç»ƒæ—¶ä¸ä½¿ç”¨ `--headless` é€‰é¡¹ï¼š

```bash
python train_parkour.py --task=tita_parkour
```

ç„¶åæŒ‰ `V` é”®åˆ‡æ¢å¯è§†åŒ–æ¨¡å¼ã€‚

---

## ğŸ¯ æ€»ç»“

### æ–¹æ¡ˆBçš„ä¼˜åŠ¿

âœ… **ä»£ç ç»„ç»‡æ¸…æ™°**ï¼šç‹¬ç«‹çš„é…ç½®ã€ç¯å¢ƒã€è®­ç»ƒè„šæœ¬  
âœ… **æ˜“äºç»´æŠ¤**ï¼šä¸å½±å“åŸæœ‰ tita_constraint ä»£ç   
âœ… **åŠŸèƒ½å®Œæ•´**ï¼šåŒ…å«è®­ç»ƒã€æµ‹è¯•ã€è¯¾ç¨‹å­¦ä¹   
âœ… **å¯æ‰©å±•æ€§å¼º**ï¼šæ˜“äºæ·»åŠ æ–°çš„å¥–åŠ±å‡½æ•°æˆ–é˜¶æ®µ  
âœ… **é…ç½®çµæ´»**ï¼šè¿­ä»£æ¬¡æ•°ã€å¥–åŠ±æƒé‡å¯è½»æ¾è°ƒæ•´  

### ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œ `python train_parkour.py --task=tita_parkour --headless`
2. âœ… ç›‘æ§ TensorBoard æŸ¥çœ‹è®­ç»ƒè¿›åº¦
3. âœ… æ ¹æ®è®­ç»ƒæ•ˆæœè°ƒæ•´å¥–åŠ±æƒé‡
4. âœ… ä½¿ç”¨ `test_parkour.py` è¯„ä¼°è®­ç»ƒå¥½çš„ç­–ç•¥

---

**ç¥è®­ç»ƒé¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜è¯·æŸ¥é˜…æ­¤æ–‡æ¡£æˆ–è”ç³»å¼€å‘è€…ã€‚** ğŸš€

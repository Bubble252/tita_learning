# ğŸš€ ä»å¤´è®­ç»ƒé…ç½®æ€»ç»“ï¼ˆä½¿ç”¨æ·±åº¦ç‰¹å¾ï¼‰

## ğŸ“Š é…ç½®å¯¹æ¯”

| é…ç½®é¡¹ | å¾®è°ƒæ¨¡å¼ï¼ˆä¹‹å‰ï¼‰ | ä»å¤´è®­ç»ƒï¼ˆå½“å‰ï¼‰ |
|--------|----------------|-----------------|
| **è§‚æµ‹ç»´åº¦** | 586 | **591** (+5) |
| **æ·±åº¦ç‰¹å¾** | âŒ ä¸ä½¿ç”¨ | âœ… **ä½¿ç”¨** (5ç»´) |
| **é¢„è®­ç»ƒæ¨¡å‹** | âœ… model_11700.pt | âŒ **ä¸ä½¿ç”¨** |
| **å­¦ä¹ ç‡** | 4e-4 (é™ä½) | **1e-3** (æ ‡å‡†) |
| **æ€»è¿­ä»£æ¬¡æ•°** | 31,000 | **40,000** (+9k) |
| **é¢„è®¡è®­ç»ƒæ—¶é—´** | 4-8å°æ—¶ | **10-15å°æ—¶** |
| **resume** | True | **False** |

---

## âœ… å½“å‰é…ç½®è¯¦æƒ…

### 1. è§‚æµ‹ç©ºé—´ï¼ˆ591ç»´ï¼‰

```python
# configs/tita_parkour_config.py
class env:
    n_proprio = 33              # æœ¬ä½“æ„Ÿè§‰
    n_scan = 187                # åœ°å½¢é«˜åº¦æ‰«æ
    history_len = 10            # å†å²é•¿åº¦
    n_priv_latent = 36          # ç‰¹æƒä¿¡æ¯
    n_depth_features = 5        # âœ… æ·±åº¦ç‰¹å¾ï¼ˆæ–°å¢ï¼‰
    
    num_observations = 33 + 187 + 330 + 36 + 5 = 591
```

**æ·±åº¦ç‰¹å¾ï¼ˆ5ç»´ï¼‰**ï¼š
1. `left_depth`: å·¦ä¾§åŒºåŸŸå¹³å‡æ·±åº¦
2. `center_depth`: ä¸­å¤®åŒºåŸŸå¹³å‡æ·±åº¦
3. `right_depth`: å³ä¾§åŒºåŸŸå¹³å‡æ·±åº¦
4. `nearest_depth`: æœ€è¿‘éšœç¢ç‰©è·ç¦»
5. `far_depth`: è¿œå¤„å¹³å‡æ·±åº¦

### 2. è®­ç»ƒé…ç½®

```python
class runner:
    # âŒ ä¸ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹
    resume = False
    resume_path = None
    
    # ä»å¤´è®­ç»ƒéœ€è¦æ›´å¤šè¿­ä»£
    max_iterations = 40000  # å¢åŠ åˆ° 40000
    
    # æ¯ 500 æ¬¡ä¿å­˜ â†’ æ€»å…± 80 ä¸ªæ£€æŸ¥ç‚¹
    save_interval = 500
```

### 3. å­¦ä¹ ç‡é…ç½®

```python
class algorithm:
    # ä»å¤´è®­ç»ƒä½¿ç”¨æ ‡å‡†å­¦ä¹ ç‡
    learning_rate = 1e-3  # âœ… ä¸é™ä½
    
    num_learning_epochs = 5
    num_mini_batches = 4
```

### 4. è¯¾ç¨‹å­¦ä¹ ï¼ˆ40000æ¬¡è¿­ä»£ï¼‰

```python
é˜¶æ®µ1ï¼šåŸºç¡€è¡Œèµ°ï¼ˆ12000æ¬¡ï¼‰
â”œâ”€ 0-12000 iterations
â”œâ”€ åœ°å½¢éš¾åº¦ï¼š0ï¼ˆå¹³åœ°ï¼‰
â”œâ”€ éšœç¢é«˜åº¦ï¼š5cm
â””â”€ é‡ç‚¹ï¼šå­¦ä¼šåŸºç¡€è¡Œèµ° + ç†è§£æ·±åº¦ä¿¡æ¯

é˜¶æ®µ2ï¼šéšœç¢è·¨è¶Šï¼ˆ12000æ¬¡ï¼‰
â”œâ”€ 12000-24000 iterations
â”œâ”€ åœ°å½¢éš¾åº¦ï¼š3ï¼ˆä¸­ç­‰ï¼‰
â”œâ”€ éšœç¢é«˜åº¦ï¼š10cm
â””â”€ é‡ç‚¹ï¼šåˆ©ç”¨æ·±åº¦ä¿¡æ¯è¯†åˆ«å’Œè·¨è¶Šéšœç¢

é˜¶æ®µ3ï¼šå®Œç¾è·‘é…·ï¼ˆ16000æ¬¡ï¼‰
â”œâ”€ 24000-40000 iterations
â”œâ”€ åœ°å½¢éš¾åº¦ï¼š7ï¼ˆé«˜éš¾åº¦ï¼‰
â”œâ”€ éšœç¢é«˜åº¦ï¼š15cm
â””â”€ é‡ç‚¹ï¼šå……åˆ†åˆ©ç”¨æ·±åº¦ä¿¡æ¯ï¼Œç²¾ç¡®è·³è·ƒå’Œç€é™†
```

### 5. æ·±åº¦ç›¸æœºé…ç½®

```python
class depth:
    use_camera = True           # âœ… å¯ç”¨
    position = [0.27, 0, 0.03] # å‰ç½®ç›¸æœº
    resized = (87, 58)         # åˆ†è¾¨ç‡
    far_clip = 2               # æœ€è¿œ2ç±³
    buffer_len = 2             # ç¼“å†²2å¸§
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆä»å¤´è®­ç»ƒï¼Ÿ

### ä¼˜ç‚¹ âœ…

1. **ç›´æ¥æ„ŸçŸ¥æ·±åº¦**
   - ç­–ç•¥ç½‘ç»œå¯ä»¥ç›´æ¥"çœ‹åˆ°"æ·±åº¦ä¿¡æ¯
   - ä¸éœ€è¦ä»…ä¾èµ–åœ°å½¢é«˜åº¦æ‰«æ
   - ç†è®ºä¸Šå¯¹éšœç¢ç‰©æ›´æ•æ„Ÿ

2. **æ›´å¥½çš„è·‘é…·è¡¨ç°**
   - æ·±åº¦ç‰¹å¾æä¾›ï¼šå·¦ã€ä¸­ã€å³ã€è¿‘ã€è¿œ 5ä¸ªæ–¹å‘çš„ä¿¡æ¯
   - å¯ä»¥æå‰é¢„åˆ¤éšœç¢ç‰©
   - æ›´ç²¾ç¡®çš„è·³è·ƒæ—¶æœº

3. **å®Œæ•´çš„ç½‘ç»œç»“æ„**
   - ç½‘ç»œä»é›¶å¼€å§‹å­¦ä¹ å¦‚ä½•ä½¿ç”¨æ·±åº¦ä¿¡æ¯
   - ä¸å—é¢„è®­ç»ƒæ¨¡å‹çš„é™åˆ¶

### ç¼ºç‚¹ âš ï¸

1. **è®­ç»ƒæ—¶é—´æ›´é•¿**
   - ä» 4-8å°æ—¶ â†’ 10-15å°æ—¶
   - éœ€è¦æ›´å¤šè¿­ä»£ï¼ˆ31k â†’ 40kï¼‰

2. **è®­ç»ƒä¸ç¨³å®š**
   - æ²¡æœ‰é¢„è®­ç»ƒåŸºç¡€
   - åˆæœŸå¯èƒ½è¡¨ç°è¾ƒå·®
   - éœ€è¦æ›´å¤šè°ƒè¯•

3. **ä¸ç¡®å®šæ€§**
   - ä¸ä¸€å®šæ¯”å¾®è°ƒæ¨¡å¼æ›´å¥½
   - æ·±åº¦ç‰¹å¾çš„ä½œç”¨éœ€è¦éªŒè¯

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹æ€»ç»“

### âœ… å·²ä¿®æ”¹æ–‡ä»¶

1. **configs/tita_parkour_config.py**
   ```python
   # è§‚æµ‹ç»´åº¦
   n_depth_features = 5
   num_observations = 591  # 586 + 5
   
   # è®­ç»ƒé…ç½®
   resume = False          # ä¸ä½¿ç”¨é¢„è®­ç»ƒ
   resume_path = None
   max_iterations = 40000  # å¢åŠ è¿­ä»£
   learning_rate = 1e-3    # æ ‡å‡†å­¦ä¹ ç‡
   ```

2. **envs/parkour_robot.py**
   ```python
   def compute_observations(self):
       super().compute_observations()  # [num_envs, 586]
       
       # âœ… æ·»åŠ æ·±åº¦ç‰¹å¾
       if self.cfg.depth.use_camera:
           depth_features = self._extract_depth_features()  # [num_envs, 5]
           self.obs_buf = torch.cat([self.obs_buf, depth_features], dim=-1)  # [num_envs, 591]
   ```

3. **utils/parkour_curriculum.py**
   ```python
   self.stages = [
       {'iterations': 12000},  # é˜¶æ®µ1ï¼š8000 â†’ 12000
       {'iterations': 12000},  # é˜¶æ®µ2ï¼š8000 â†’ 12000
       {'iterations': 16000},  # é˜¶æ®µ3ï¼š15000 â†’ 16000
   ]
   # æ€»è®¡ï¼š12000 + 12000 + 16000 = 40000
   ```

---

## ğŸš€ å¦‚ä½•å¼€å§‹è®­ç»ƒ

### 1. åœæ­¢ä¹‹å‰çš„è®­ç»ƒï¼ˆå¦‚æœè¿˜åœ¨è¿è¡Œï¼‰

```bash
# æŸ¥æ‰¾è®­ç»ƒè¿›ç¨‹
ps aux | grep train_parkour

# åœæ­¢è¿›ç¨‹ï¼ˆæ›¿æ¢ PIDï¼‰
kill <PID>

# æˆ–è€…å¼ºåˆ¶åœæ­¢
pkill -f train_parkour
```

### 2. æ¸…ç†ä¹‹å‰çš„æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

```bash
# å¤‡ä»½ä¹‹å‰çš„æ—¥å¿—
mv logs/tita_parkour/parkour_with_curriculum logs/tita_parkour/parkour_with_curriculum_backup

# æˆ–è€…ç›´æ¥åˆ é™¤
rm -rf logs/tita_parkour/parkour_with_curriculum
```

### 3. å¯åŠ¨æ–°çš„è®­ç»ƒ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/bubble/æ¡Œé¢/tita/tita_rl

# æ¿€æ´»ç¯å¢ƒ
conda activate tita2

# âœ… ä»å¤´è®­ç»ƒï¼ˆæ— å¯è§†åŒ–ï¼Œæœ€å¿«ï¼‰
python train_parkour.py --task=tita_parkour --headless

# æˆ–è€…å¸¦å¯è§†åŒ–ï¼ˆå¯ä»¥çœ‹åˆ°æ·±åº¦å›¾åƒï¼‰
python train_parkour.py --task=tita_parkour
```

### 4. åå°è¿è¡Œï¼ˆæ¨èï¼‰

```bash
# ä½¿ç”¨ nohup
nohup python train_parkour.py --task=tita_parkour --headless > training_from_scratch.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f training_from_scratch.log
```

---

## ğŸ“Š è®­ç»ƒç›‘æ§

### TensorBoard

```bash
tensorboard --logdir=logs/tita_parkour --port=6006
```

**å…³é”®æŒ‡æ ‡**ï¼š
- `Train/mean_reward`: åº”é€æ¸å¢åŠ ï¼Œç›®æ ‡ > 15
- `Train/mean_episode_length`: åº”é€æ¸å¢åŠ 
- `Curriculum/stage_index`: 0 â†’ 1 â†’ 2ï¼ˆé˜¶æ®µåˆ‡æ¢ï¼‰
- `Depth/feature_mean`: æ·±åº¦ç‰¹å¾çš„å¹³å‡å€¼

### GPU ç›‘æ§

```bash
watch -n 1 nvidia-smi
```

### å®æ—¶æ—¥å¿—

```bash
tail -f logs/tita_parkour/parkour_with_curriculum/*/training.log
```

---

## ğŸ“ˆ é¢„æœŸè®­ç»ƒè¿›åº¦

### é˜¶æ®µ1ï¼ˆ0-12000æ¬¡ï¼Œçº¦3-4å°æ—¶ï¼‰

**ç›®æ ‡**ï¼š
- âœ… å­¦ä¼šç«™ç«‹å’ŒåŸºæœ¬è¡Œèµ°
- âœ… å¥–åŠ±ä» -5 æå‡åˆ° 5
- âœ… å­˜æ´»æ—¶é—´ä» 5ç§’ æå‡åˆ° 15ç§’

**æ·±åº¦ç‰¹å¾ä½œç”¨**ï¼š
- å­¦ä¹ è¯†åˆ«å¹³åœ° vs éšœç¢ç‰©
- æ·±åº¦ç‰¹å¾åº”è¯¥å¼€å§‹æœ‰å·®å¼‚

### é˜¶æ®µ2ï¼ˆ12000-24000æ¬¡ï¼Œçº¦3-4å°æ—¶ï¼‰

**ç›®æ ‡**ï¼š
- âœ… èƒ½å¤Ÿè·¨è¶Šå°éšœç¢ï¼ˆ10cmï¼‰
- âœ… å¥–åŠ±ä» 5 æå‡åˆ° 12
- âœ… ç¢°æ’ç‡é™ä½åˆ° < 20%

**æ·±åº¦ç‰¹å¾ä½œç”¨**ï¼š
- åˆ©ç”¨æ·±åº¦ä¿¡æ¯æå‰æ„ŸçŸ¥éšœç¢
- è°ƒæ•´æ­¥æ€é¿å¼€éšœç¢

### é˜¶æ®µ3ï¼ˆ24000-40000æ¬¡ï¼Œçº¦4-6å°æ—¶ï¼‰

**ç›®æ ‡**ï¼š
- âœ… å®Œç¾è·‘é…·ï¼Œé«˜éšœç¢ï¼ˆ15cmï¼‰
- âœ… å¥–åŠ±ä» 12 æå‡åˆ° 18+
- âœ… ç¢°æ’ç‡é™ä½åˆ° < 5%
- âœ… ç²¾ç¡®è·³è·ƒå’Œç¨³å®šç€é™†

**æ·±åº¦ç‰¹å¾ä½œç”¨**ï¼š
- å……åˆ†åˆ©ç”¨æ·±åº¦ä¿¡æ¯
- æœ€ä¼˜è·³è·ƒæ—¶æœº
- é¢„åˆ¤å¤æ‚åœ°å½¢

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æœ€ä½æ ‡å‡†ï¼ˆå¯æ¥å—ï¼‰

- å¹³å‡å¥–åŠ± > 15
- ç¢°æ’ç‡ < 10%
- èƒ½åœ¨ä¸­ç­‰éš¾åº¦åœ°å½¢ç¨³å®šè¡Œèµ°

### ä¼˜ç§€æ ‡å‡†ï¼ˆç›®æ ‡ï¼‰

- å¹³å‡å¥–åŠ± > 18
- ç¢°æ’ç‡ < 5%
- èƒ½åœ¨é«˜éš¾åº¦åœ°å½¢æµç•…è·‘é…·
- æ·±åº¦ç‰¹å¾è¢«æœ‰æ•ˆåˆ©ç”¨

### å¦‚ä½•åˆ¤æ–­æ·±åº¦ç‰¹å¾æ˜¯å¦æœ‰æ•ˆï¼Ÿ

1. **å¯¹æ¯”å®éªŒ**ï¼ˆè®­ç»ƒå®Œæˆåï¼‰ï¼š
   ```python
   # æµ‹è¯•æ—¶å…³é—­æ·±åº¦ç‰¹å¾
   env.cfg.depth.use_camera = False
   # å¦‚æœæ€§èƒ½æ˜æ˜¾ä¸‹é™ï¼Œè¯´æ˜æ·±åº¦ç‰¹å¾æœ‰æ•ˆ
   ```

2. **æŸ¥çœ‹æ·±åº¦ç‰¹å¾å€¼**ï¼š
   ```python
   # æ‰“å°æ·±åº¦ç‰¹å¾
   print(depth_features)  # åº”è¯¥æœ‰æ˜æ˜¾å˜åŒ–ï¼Œä¸æ˜¯å…¨é›¶æˆ–å¸¸æ•°
   ```

3. **å¯è§†åŒ–åˆ†æ**ï¼š
   - åœ¨æœ‰éšœç¢ç‰©æ—¶ï¼Œ`nearest_depth` åº”è¯¥å˜å°
   - åœ¨è½¬å¼¯æ—¶ï¼Œ`left_depth` å’Œ `right_depth` åº”è¯¥æœ‰å·®å¼‚

---

## ğŸ”„ å›æ»šè®¡åˆ’ï¼ˆå¦‚æœæ•ˆæœä¸å¥½ï¼‰

å¦‚æœä»å¤´è®­ç»ƒæ•ˆæœä¸ç†æƒ³ï¼Œå¯ä»¥å›æ»šåˆ°å¾®è°ƒæ¨¡å¼ï¼š

```bash
# 1. æ¢å¤é…ç½®
git checkout configs/tita_parkour_config.py
git checkout envs/parkour_robot.py
git checkout utils/parkour_curriculum.py

# 2. é‡æ–°è®­ç»ƒï¼ˆå¾®è°ƒæ¨¡å¼ï¼‰
python train_parkour.py --task=tita_parkour --headless
```

**æˆ–è€…æ‰‹åŠ¨ä¿®æ”¹**ï¼š
```python
# configs/tita_parkour_config.py
num_observations = 586  # ç§»é™¤æ·±åº¦ç‰¹å¾
resume = True
resume_path = '/home/bubble/æ¡Œé¢/tita/tita_rl/model_11700.pt'
max_iterations = 31000
learning_rate = 4e-4
```

---

## ğŸ“ æ£€æŸ¥æ¸…å•

å¼€å§‹è®­ç»ƒå‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] âœ… è§‚æµ‹ç»´åº¦ï¼š591ï¼ˆ586 + 5ï¼‰
- [ ] âœ… resume = Falseï¼ˆä¸ä½¿ç”¨é¢„è®­ç»ƒï¼‰
- [ ] âœ… max_iterations = 40000
- [ ] âœ… learning_rate = 1e-3
- [ ] âœ… æ·±åº¦ç›¸æœºå¯ç”¨ï¼šuse_camera = True
- [ ] âœ… è¯¾ç¨‹å­¦ä¹ ï¼š12000 + 12000 + 16000
- [ ] âœ… ä¹‹å‰çš„è®­ç»ƒå·²åœæ­¢
- [ ] âœ… æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆ~2GBï¼Œ80ä¸ªæ£€æŸ¥ç‚¹ï¼‰
- [ ] âœ… å‡†å¤‡ç­‰å¾… 10-15 å°æ—¶

---

## ğŸ‰ å¼€å§‹è®­ç»ƒå‘½ä»¤

```bash
# æœ€ç»ˆå‘½ä»¤
cd /home/bubble/æ¡Œé¢/tita/tita_rl
conda activate tita2
nohup python train_parkour.py --task=tita_parkour --headless > training_from_scratch.log 2>&1 &

# ç›‘æ§è®­ç»ƒ
tail -f training_from_scratch.log
tensorboard --logdir=logs/tita_parkour --port=6006
```

ç¥è®­ç»ƒæˆåŠŸï¼æœŸå¾…çœ‹åˆ°æ·±åº¦ç‰¹å¾çš„å¼ºå¤§ä½œç”¨ï¼ğŸš€
